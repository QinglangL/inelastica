

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Inelastica.MiscMath &mdash; Inelastica |release| documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Inelastica |release| documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Inelastica
          

          
            
            <img src="../../_static/82px-Inelastica-logo-mini.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.3.0-10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../more.html">More documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Publications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cite.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications using Inelastica</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Inelastica</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>Inelastica.MiscMath</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Inelastica.MiscMath</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">N</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">LA</span>
<span class="kn">import</span> <span class="nn">numpy.fft</span> <span class="kn">as</span> <span class="nn">FFT</span>

<span class="c1">##############################################################</span>

<div class="viewcode-block" id="mm"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.mm">[docs]</a><span class="k">def</span> <span class="nf">mm</span><span class="p">(</span><span class="o">*</span> <span class="n">args</span><span class="p">):</span>
    <span class="c1"># Matrix multiplication with arbitrary number of arguments</span>
    <span class="c1"># and the SpectralMatrix type</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="c1"># Look for SpectralMatrices</span>
    <span class="n">where</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">SpectralMatrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">where</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">__mmSpectralMatrix</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="n">where</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span><span class="o">=</span> <span class="n">__mm</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">res</span></div>

<span class="k">def</span> <span class="nf">__mmSpectralMatrix</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="n">where</span><span class="p">):</span>
    <span class="c1"># find smallest</span>
    <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="n">where</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">where</span><span class="p">))]</span>
    <span class="n">smallest</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">==</span><span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">size</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># if more than one SpectralMatrix, expand others into normal matrices</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span> <span class="c1"># To get flatten to work</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">where</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">!=</span><span class="n">where</span><span class="p">[</span><span class="n">smallest</span><span class="p">]:</span>
            <span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">R</span><span class="p">]</span>
    <span class="n">args</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">,[])</span> <span class="c1"># Flatten list</span>

    <span class="c1"># Split at Spectral matrix</span>
    <span class="n">where</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">SpectralMatrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">res</span><span class="o">=</span><span class="n">SpectralMatrix</span><span class="p">()</span>
    <span class="n">res</span><span class="o">.</span><span class="n">L</span><span class="o">=</span><span class="n">__mm</span><span class="p">(</span><span class="n">args</span><span class="p">[:</span><span class="n">where</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="n">where</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">L</span><span class="p">])</span>
    <span class="n">res</span><span class="o">.</span><span class="n">R</span><span class="o">=</span><span class="n">__mm</span><span class="p">([</span><span class="n">args</span><span class="p">[</span><span class="n">where</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">R</span><span class="p">]</span><span class="o">+</span><span class="n">args</span><span class="p">[</span><span class="n">where</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">__mm</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># Normal matrix mult, order important for speed if matrices has different sizes</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Find smallest matrix</span>
    <span class="n">Lsize</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Most rightmost is vector </span>
        <span class="n">Rsize</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Rsize</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>

    <span class="n">Lwhere</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Lsize</span><span class="o">==</span><span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Lsize</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Rwhere</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Rsize</span><span class="o">==</span><span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Rsize</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Lsize</span><span class="p">)</span><span class="o">&gt;</span><span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Rsize</span><span class="p">):</span>
        <span class="n">where</span> <span class="o">=</span> <span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">Rwhere</span><span class="p">]</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">Lwhere</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">True</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">where</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Order does not matter</span>
        <span class="n">res</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">res</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Make sure the matrix mult is done in order of smaller</span>
        <span class="c1"># matrices first</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">where</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">__mm</span><span class="p">([</span><span class="n">__mm</span><span class="p">([</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]])]</span><span class="o">+</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="n">ii</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">__mm</span><span class="p">(</span><span class="n">args</span><span class="p">[:</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">__mm</span><span class="p">([</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="p">]])])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">left</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">__mm</span><span class="p">(</span><span class="n">args</span><span class="p">[:</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">__mm</span><span class="p">([</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">+</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">:])])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">__mm</span><span class="p">([</span><span class="n">__mm</span><span class="p">(</span><span class="n">args</span><span class="p">[:</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="p">]])]</span><span class="o">+</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="c1">##############################################################</span>

<div class="viewcode-block" id="outerAdd"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.outerAdd">[docs]</a><span class="k">def</span> <span class="nf">outerAdd</span><span class="p">(</span><span class="o">*</span> <span class="n">args</span><span class="p">):</span>
    <span class="c1"># A_ijk=B_i+C_j+D_k</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
        <span class="n">tmp</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">args</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tmp</span></div>

<div class="viewcode-block" id="dist"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.dist">[docs]</a><span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">))</span></div>

<div class="viewcode-block" id="mysqrt"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.mysqrt">[docs]</a><span class="k">def</span> <span class="nf">mysqrt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># Square root of matrix    </span>
    <span class="n">ev</span><span class="p">,</span><span class="n">U</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>

    <span class="n">tmp</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">)),</span><span class="n">N</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">)):</span>
        <span class="n">tmp</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ev</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">mm</span><span class="p">(</span><span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">U</span><span class="p">),</span><span class="n">tmp</span><span class="p">,</span><span class="n">U</span><span class="p">)</span></div>

<span class="c1">##############################################################</span>

<div class="viewcode-block" id="fermi"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.fermi">[docs]</a><span class="k">def</span> <span class="nf">fermi</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">kT</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">E</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">kT</span><span class="p">,</span><span class="o">-</span><span class="mf">70.0</span><span class="p">,</span><span class="mf">70.0</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="box"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.box">[docs]</a><span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="n">mu1</span><span class="p">,</span><span class="n">mu2</span><span class="p">,</span><span class="n">grid</span><span class="p">,</span><span class="n">kT</span><span class="p">):</span>
    <span class="c1"># f2-f1 (Box!)</span>
    <span class="k">return</span> <span class="n">fermi</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span><span class="n">grid</span><span class="p">,</span><span class="n">kT</span><span class="p">)</span><span class="o">-</span><span class="n">fermi</span><span class="p">(</span><span class="n">mu1</span><span class="p">,</span><span class="n">grid</span><span class="p">,</span><span class="n">kT</span><span class="p">)</span></div>

<span class="c1">##############################################################</span>
<div class="viewcode-block" id="trapez"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.trapez">[docs]</a><span class="k">def</span> <span class="nf">trapez</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">equidistant</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Integration of vector f on grid x using the 3rd degree polynomial.</span>
<span class="sd">    The grid x does not have to be equidistant.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">equidistant</span><span class="p">:</span>
        <span class="c1"># Trapez method!</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">N</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 3rd degree polynomial except for 1st and last bins</span>
        <span class="nb">sum</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x3</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">y0</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">y3</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
            <span class="nb">sum</span><span class="o">+=</span><span class="p">((</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">x0</span><span class="o">*</span><span class="n">x2</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span>\
                 <span class="mi">3</span><span class="o">*</span><span class="n">x2</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span>\
                 <span class="n">x1</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x2</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">x0</span><span class="o">*</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span>\
                 <span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">y0</span><span class="o">+</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span><span class="n">x2</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">y0</span><span class="o">+</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">x0</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">y1</span><span class="o">+</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span>\
                 <span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x3</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">x0</span><span class="o">*</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span>\
                 <span class="mi">2</span><span class="o">*</span><span class="n">x0</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">y1</span><span class="o">+</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span><span class="n">x1</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">y0</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">x2</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y3</span><span class="p">)</span><span class="o">+</span><span class="n">x0</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">y2</span><span class="o">+</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span>\
                 <span class="n">x1</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">x0</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x2</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">x0</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span>\
                 <span class="n">x2</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y3</span><span class="p">)</span><span class="o">+</span><span class="n">x2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">x0</span><span class="o">*</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span>\
                 <span class="mi">4</span><span class="o">*</span><span class="n">x3</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">+</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">x0</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="o">+</span><span class="n">y3</span><span class="p">))</span><span class="o">-</span>\
                 <span class="mi">3</span><span class="o">*</span><span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="o">+</span><span class="n">y3</span><span class="p">)))</span><span class="o">+</span>\
                 <span class="n">x1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x3</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">x0</span><span class="o">*</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span>\
                 <span class="n">x2</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">y0</span><span class="o">+</span><span class="n">y3</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">x0</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">y2</span><span class="o">+</span><span class="n">y3</span><span class="p">)</span><span class="o">-</span>\
                 <span class="mi">3</span><span class="o">*</span><span class="n">x2</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">+</span><span class="n">y1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">y2</span><span class="o">+</span><span class="n">y3</span><span class="p">))</span><span class="o">+</span>\
                 <span class="mi">3</span><span class="o">*</span><span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">y0</span><span class="o">+</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">x0</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="n">y2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">y3</span><span class="p">)))))</span><span class="o">/</span>\
                 <span class="p">(</span><span class="mf">12.</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x3</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">sum</span></div>
<span class="c1">##############################################################</span>

<div class="viewcode-block" id="interpolate"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.interpolate">[docs]</a><span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolate f(x)=y to find f(nx)</span>
<span class="sd">    Makes no checks for nx inside x region!!!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ny</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span>
    <span class="n">Lpos</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span><span class="n">pos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Lpos</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pos</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">ny</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">nx</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#TF: NB EXTRAPOLATION condition added!</span>
            <span class="n">ny</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">nx</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ny</span></div>

<span class="c1">##############################################################</span>
<span class="c1"># DEFINITION OF THE HILBERT TRANSFORM:</span>
<span class="c1"># H[f](y) = 1/\pi p.v.\int^{\infty}_{\infty} dx { f(x)/(x-y) }</span>
<div class="viewcode-block" id="Hilbert"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.Hilbert">[docs]</a><span class="k">def</span> <span class="nf">Hilbert</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ker</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s1">&#39;Hilbert transform&#39;</span>
    
    <span class="k">def</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="s1">&#39;Hilbert transform kernel&#39;</span>
        <span class="n">nh</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">n</span>   <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nh</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nh</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nh</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">*</span> <span class="n">tmp</span>
        <span class="n">ker</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">ker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ker</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nh</span><span class="p">]</span>  <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">nh</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nh</span><span class="p">]</span> <span class="o">+</span> <span class="n">aux</span><span class="p">[:</span><span class="n">nh</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ker</span><span class="p">[</span><span class="n">nh</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ker</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nh</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">FFT</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">ker</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ker</span><span class="p">):</span>
        <span class="s1">&#39;Convolution with kernel&#39;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">fpad</span> <span class="o">=</span> <span class="n">FFT</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">f</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">FFT</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">fpad</span><span class="o">*</span><span class="n">ker</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ker</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="c1"># A kernel was specified at the function call</span>
        <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ker</span><span class="p">),</span> <span class="n">ker</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;Hilbert: Generating kernel&#39;</span>
        <span class="n">ker</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ker</span><span class="p">),</span> <span class="n">ker</span></div>

<span class="c1">##############################################################</span>

<div class="viewcode-block" id="sphericalHarmonics"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.sphericalHarmonics">[docs]</a><span class="k">def</span> <span class="nf">sphericalHarmonics</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">costh</span><span class="p">,</span><span class="n">sinfi</span><span class="p">,</span><span class="n">cosfi</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">scipy.special</span> <span class="kn">as</span> <span class="nn">SS</span>
    <span class="c1"># New faster Spherical Harmonics. Checked up to d-orbitals with the Siesta overlap matrix.</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">m</span><span class="p">))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">m</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
        <span class="n">ffi</span><span class="o">=</span><span class="n">norm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">expimfi</span> <span class="o">=</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">+</span><span class="mf">1.0j</span><span class="o">*</span><span class="n">sinfi</span><span class="p">)</span><span class="o">**</span><span class="n">m</span> <span class="c1"># Find sin(m fi) and cos(m fi) as im and re parts</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span>
            <span class="n">ffi</span>  <span class="o">=</span> <span class="n">norm</span> <span class="o">*</span> <span class="n">expimfi</span><span class="o">.</span><span class="n">imag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span>
            <span class="n">ffi</span>  <span class="o">=</span> <span class="n">norm</span> <span class="o">*</span> <span class="n">expimfi</span><span class="o">.</span><span class="n">real</span>
    <span class="k">return</span> <span class="n">SS</span><span class="o">.</span><span class="n">lpmv</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">costh</span><span class="p">)</span><span class="o">*</span><span class="n">ffi</span></div>

<div class="viewcode-block" id="OLD_sphericalHarmonics"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.OLD_sphericalHarmonics">[docs]</a><span class="k">def</span> <span class="nf">OLD_sphericalHarmonics</span><span class="p">(</span><span class="n">sinth</span><span class="p">,</span><span class="n">costh</span><span class="p">,</span><span class="n">sinfi</span><span class="p">,</span><span class="n">cosfi</span><span class="p">):</span>
    <span class="n">pi</span><span class="o">=</span><span class="mf">3.141592654</span>

    <span class="c1"># l=0 m=0</span>
    <span class="n">Y00</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
    <span class="c1"># l=1 m=-1</span>
    <span class="n">Y1m1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
    <span class="c1"># l=1 m=0</span>
    <span class="n">Y10</span> <span class="o">=</span> <span class="p">(</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span>
    <span class="c1"># l=1 m=1</span>
    <span class="n">Y11</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">cosfi</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
    <span class="c1"># l=2 m=-2</span>
    <span class="n">Y2m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span> <span class="o">-</span> \
        <span class="p">(</span><span class="n">cosfi</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span> <span class="o">+</span> \
        <span class="p">(</span><span class="n">cosfi</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span>
    <span class="c1"># l=2 m=-1</span>
    <span class="n">Y2m1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
    <span class="c1"># l=2 m=0</span>
    <span class="n">Y20</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>
    <span class="c1"># l=2 m=1</span>
    <span class="n">Y21</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">cosfi</span><span class="o">*</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
    <span class="c1"># l=2 m=2</span>
    <span class="n">Y22</span> <span class="o">=</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span><span class="mf">8.</span> <span class="o">-</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span> \
        <span class="mf">8.</span> <span class="o">-</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span> <span class="o">+</span> <span class="p">(</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span> \
        <span class="mf">8.</span> <span class="o">+</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span> <span class="o">-</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span>    <span class="mf">8.</span>
    <span class="c1"># l=3 m=-3</span>
    <span class="n">Y3m3</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="o">*</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span> \
        <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span> \
        <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span>  \
        <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">16.</span>
    <span class="c1"># l=3 m=-2</span>
    <span class="n">Y3m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">*</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span> <span class="o">-</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="p">)</span><span class="o">/</span>    <span class="mf">8.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cosfi</span><span class="o">*</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">8.</span>
    <span class="c1"># l=3 m=-1</span>
    <span class="n">Y3m1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">21</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">15</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">21</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">21</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">16.</span>
    <span class="c1"># l=3 m=0</span>
    <span class="n">Y30</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span><span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">15</span><span class="o">*</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">16.</span>
    <span class="c1"># l=3 m=1</span>
    <span class="n">Y31</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">cosfi</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">21</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">15</span><span class="o">*</span><span class="n">cosfi</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">21</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">cosfi</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">21</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">16.</span>
    <span class="c1"># l=3 m=2</span>
    <span class="n">Y32</span> <span class="o">=</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span><span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span> \
        <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="n">costh</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span> \
        <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">costh</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">105</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">16.</span>
    <span class="c1"># l=3 m=3</span>
    <span class="n">Y33</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span> \
        <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">cosfi</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">cosfi</span><span class="o">*</span><span class="n">costh</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sinth</span><span class="p">)</span><span class="o">/</span> \
        <span class="mf">16.</span> <span class="o">-</span> <span class="p">(</span><span class="n">cosfi</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span>    <span class="mf">16.</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cosfi</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">35</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">sinfi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sinth</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">16.</span>
    
    <span class="k">return</span> <span class="p">[[</span><span class="n">Y00</span><span class="p">],</span>
            <span class="p">[</span><span class="n">Y1m1</span><span class="p">,</span><span class="n">Y10</span><span class="p">,</span><span class="n">Y11</span><span class="p">],</span>
            <span class="p">[</span><span class="n">Y2m2</span><span class="p">,</span><span class="n">Y2m1</span><span class="p">,</span><span class="n">Y20</span><span class="p">,</span><span class="n">Y21</span><span class="p">,</span><span class="n">Y22</span><span class="p">],</span>
            <span class="p">[</span><span class="n">Y3m3</span><span class="p">,</span><span class="n">Y3m2</span><span class="p">,</span><span class="n">Y3m1</span><span class="p">,</span><span class="n">Y30</span><span class="p">,</span><span class="n">Y31</span><span class="p">,</span><span class="n">Y32</span><span class="p">,</span><span class="n">Y33</span><span class="p">]]</span></div>

<span class="c1">##############################################################</span>
<span class="c1"># GaussKronrod</span>

<div class="viewcode-block" id="abwe1"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.abwe1">[docs]</a><span class="k">def</span> <span class="nf">abwe1</span> <span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">even</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span> <span class="p">)</span> <span class="p">:</span>
<span class="c1">#*****************************************************************************80</span>
<span class="c1">## ABWE1 calculates a Kronrod abscissa and weight.</span>
<span class="c1">#  Licensing:</span>
<span class="c1">#    This code is distributed under the GNU LGPL license.</span>
<span class="c1">#  Modified:</span>
<span class="c1">#    30 April 2013</span>
<span class="c1">#  Author:</span>
<span class="c1">#    Original FORTRAN77 version by Robert Piessens, Maria Branders.</span>
<span class="c1">#    Python version by John Burkardt.</span>
<span class="c1">#  Reference:</span>
<span class="c1">#    Robert Piessens, Maria Branders,</span>
<span class="c1">#    A Note on the Optimal Addition of Abscissas to Quadrature Formulas</span>
<span class="c1">#    of Gauss and Lobatto,</span>
<span class="c1">#    Mathematics of Computation,</span>
<span class="c1">#    Volume 28, Number 125, January 1974, pages 135-139.</span>
  <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="nb">exit</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="p">):</span>    <span class="n">ka</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">else</span><span class="p">:</span>    <span class="n">ka</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">51</span> <span class="p">):</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">2.0</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">even</span> <span class="p">):</span>
      <span class="n">ai</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="n">ai</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">dif</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ai</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="n">dif</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
      <span class="n">ai</span> <span class="o">=</span> <span class="n">ai</span> <span class="o">-</span> <span class="n">dif</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">b0</span> <span class="o">=</span> <span class="n">b1</span>
      <span class="n">b1</span> <span class="o">=</span> <span class="n">b2</span>
      <span class="n">d0</span> <span class="o">=</span> <span class="n">d1</span>
      <span class="n">d1</span> <span class="o">=</span> <span class="n">d2</span>
      <span class="n">b2</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span> <span class="ow">not</span> <span class="n">even</span> <span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">d0</span> <span class="o">+</span> <span class="n">ai</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">even</span> <span class="p">):</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">b1</span> <span class="p">)</span>
      <span class="n">fd</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">+</span> <span class="n">d1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">f</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">b0</span> <span class="p">)</span>
      <span class="n">fd</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">d2</span>
<span class="c1">#</span>
<span class="c1">#  Newton correction.</span>
<span class="c1">#</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">fd</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">delta</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">ka</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">):</span>
      <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">abs</span> <span class="p">(</span> <span class="n">delta</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span> <span class="p">):</span>
      <span class="n">ka</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1">#</span>
<span class="c1">#  Catch non-convergence.</span>
<span class="c1">#</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">ka</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">):</span>
    <span class="k">print</span> <span class="s1">&#39;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;ABWE1 - Fatal error!&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;  Iteration limit reached.&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;  Last DELTA was </span><span class="si">%e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">delta</span> <span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span> <span class="p">(</span> <span class="s1">&#39;ABWE1 - Fatal error!&#39;</span> <span class="p">)</span>
<span class="c1">#</span>
<span class="c1">#  Computation of the weight.</span>
<span class="c1">#</span>
  <span class="n">d0</span> <span class="o">=</span> <span class="mf">1.0</span>
  <span class="n">d1</span> <span class="o">=</span> <span class="n">x</span>
  <span class="n">ai</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
    <span class="n">ai</span> <span class="o">=</span> <span class="n">ai</span> <span class="o">+</span> <span class="mf">1.0</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span> <span class="n">ai</span> <span class="o">+</span> <span class="n">ai</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">ai</span> <span class="o">*</span> <span class="n">d0</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">ai</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span>
    <span class="n">d0</span> <span class="o">=</span> <span class="n">d1</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">d2</span>
  <span class="n">w</span> <span class="o">=</span> <span class="n">coef2</span> <span class="o">/</span> <span class="p">(</span> <span class="n">fd</span> <span class="o">*</span> <span class="n">d2</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">w</span></div>

<div class="viewcode-block" id="abwe2"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.abwe2">[docs]</a><span class="k">def</span> <span class="nf">abwe2</span> <span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">even</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span> <span class="p">):</span>
<span class="c1">#*****************************************************************************80</span>
<span class="c1">## ABWE2 calculates a Gaussian abscissa and two weights.</span>
<span class="c1">#  Licensing:</span>
<span class="c1">#    This code is distributed under the GNU LGPL license.</span>
<span class="c1">#  Modified:</span>
<span class="c1">#    30 April 2013</span>
<span class="c1">#  Author:</span>
<span class="c1">#    Original FORTRAN77 version by Robert Piessens, Maria Branders.</span>
<span class="c1">#    PYTHON version by John Burkardt.</span>
<span class="c1">#  Reference:</span>
<span class="c1">#    Robert Piessens, Maria Branders,</span>
<span class="c1">#    A Note on the Optimal Addition of Abscissas to Quadrature Formulas</span>
<span class="c1">#    of Gauss and Lobatto,</span>
<span class="c1">#    Mathematics of Computation,</span>
<span class="c1">#    Volume 28, Number 125, January 1974, pages 135-139.</span>
  <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="nb">exit</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="p">):</span>    <span class="n">ka</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">else</span><span class="p">:</span>    <span class="n">ka</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">51</span> <span class="p">):</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">pd0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">pd1</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="p">):</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">x</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="p">):</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">pd2</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">x</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">x</span>
        <span class="n">pd2</span> <span class="o">=</span> <span class="mf">3.0</span>

    <span class="n">ai</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
      <span class="n">ai</span> <span class="o">=</span> <span class="n">ai</span> <span class="o">+</span> <span class="mf">1.0</span>
      <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span> <span class="n">ai</span> <span class="o">+</span> <span class="n">ai</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">ai</span> <span class="o">*</span> <span class="n">p0</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">ai</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span>
      <span class="n">pd2</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span> <span class="n">ai</span> <span class="o">+</span> <span class="n">ai</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">pd1</span> <span class="p">)</span> <span class="o">-</span> <span class="n">ai</span> <span class="o">*</span> <span class="n">pd0</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">ai</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span>
      <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span>
      <span class="n">p1</span> <span class="o">=</span> <span class="n">p2</span>
      <span class="n">pd0</span> <span class="o">=</span> <span class="n">pd1</span>
      <span class="n">pd1</span> <span class="o">=</span> <span class="n">pd2</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">/</span> <span class="n">pd2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">delta</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">ka</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">):</span>
      <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">abs</span> <span class="p">(</span> <span class="n">delta</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span> <span class="p">):</span>
      <span class="n">ka</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">ka</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">):</span>
    <span class="k">print</span> <span class="s1">&#39;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;ABWE2 - Fatal error!&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;  Iteration limit reached.&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;  Last DELTA was </span><span class="si">%e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">delta</span> <span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span> <span class="p">(</span> <span class="s1">&#39;ABWE2 - Fatal error!&#39;</span> <span class="p">)</span>
  <span class="n">an</span> <span class="o">=</span> <span class="n">n</span>
  <span class="n">w2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span> <span class="n">an</span> <span class="o">*</span> <span class="n">pd2</span> <span class="o">*</span> <span class="n">p0</span> <span class="p">)</span>
  <span class="n">p1</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="n">p2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">yy</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">2.0</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">p1</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">p2</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p0</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">even</span> <span class="p">):</span>
    <span class="n">w1</span> <span class="o">=</span> <span class="n">w2</span> <span class="o">+</span> <span class="n">coef2</span> <span class="o">/</span> <span class="p">(</span> <span class="n">pd2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span> <span class="p">)</span> <span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">w1</span> <span class="o">=</span> <span class="n">w2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">coef2</span> <span class="o">/</span> <span class="p">(</span> <span class="n">pd2</span> <span class="o">*</span> <span class="p">(</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p0</span> <span class="p">)</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span></div>

<div class="viewcode-block" id="kronrod"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.kronrod">[docs]</a><span class="k">def</span> <span class="nf">kronrod</span> <span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">tol</span> <span class="p">):</span>
<span class="c1">#*****************************************************************************80</span>
<span class="c1">#</span>
<span class="c1">## KRONROD adds N+1 points to an N-point Gaussian rule.</span>
<span class="c1">#</span>
<span class="c1">#  Discussion:</span>
<span class="c1">#</span>
<span class="c1">#    This subroutine calculates the abscissas and weights of the 2N+1</span>
<span class="c1">#    point Gauss Kronrod quadrature formula which is obtained from the</span>
<span class="c1">#    N point Gauss quadrature formula by the optimal addition of N+1 points.</span>
<span class="c1">#</span>
<span class="c1">#    The optimally added points are called Kronrod abscissas.  The</span>
<span class="c1">#    abscissas and weights for both the Gauss and Gauss Kronrod rules</span>
<span class="c1">#    are calculated for integration over the interval [-1,+1].</span>
<span class="c1">#</span>
<span class="c1">#    Since the quadrature formula is symmetric with respect to the origin,</span>
<span class="c1">#    only the nonnegative abscissas are calculated.</span>
<span class="c1">#</span>
<span class="c1">#    Note that the code published in Mathematics of Computation</span>
<span class="c1">#    omitted the definition of the variable which is here called COEF2.</span>
<span class="c1">#</span>
<span class="c1">#  Storage:</span>
<span class="c1">#</span>
<span class="c1">#    Given N, let M = ( N + 1 ) / 2.</span>
<span class="c1">#</span>
<span class="c1">#    The Gauss-Kronrod rule will include 2*N+1 points.  However, by symmetry,</span>
<span class="c1">#    only N + 1 of them need to be listed.</span>
<span class="c1">#</span>
<span class="c1">#    The arrays X, W1 and W2 contain the nonnegative abscissas in decreasing</span>
<span class="c1">#    order, and the weights of each abscissa in the Gauss-Kronrod and</span>
<span class="c1">#    Gauss rules respectively.  This means that about half the entries</span>
<span class="c1">#    in W2 are zero.</span>
<span class="c1">#</span>
<span class="c1">#    For instance, if N = 3, the output is:</span>
<span class="c1">#</span>
<span class="c1">#    I      X               W1              W2</span>
<span class="c1">#</span>
<span class="c1">#    1    0.960491        0.104656         0.000000</span>
<span class="c1">#    2    0.774597        0.268488         0.555556</span>
<span class="c1">#    3    0.434244        0.401397         0.000000</span>
<span class="c1">#    4    0.000000        0.450917         0.888889</span>
<span class="c1">#</span>
<span class="c1">#    and if N = 4, (notice that 0 is now a Kronrod abscissa)</span>
<span class="c1">#    the output is</span>
<span class="c1">#</span>
<span class="c1">#    I      X               W1              W2</span>
<span class="c1">#</span>
<span class="c1">#    1    0.976560        0.062977        0.000000</span>
<span class="c1">#    2    0.861136        0.170054        0.347855</span>
<span class="c1">#    3    0.640286        0.266798        0.000000</span>
<span class="c1">#    4    0.339981        0.326949        0.652145</span>
<span class="c1">#    5    0.000000        0.346443        0.000000</span>
<span class="c1">#</span>
<span class="c1">#  Licensing:</span>
<span class="c1">#</span>
<span class="c1">#    This code is distributed under the GNU LGPL license.</span>
<span class="c1">#</span>
<span class="c1">#  Modified:</span>
<span class="c1">#</span>
<span class="c1">#    30 April 2013</span>
<span class="c1">#</span>
<span class="c1">#  Author:</span>
<span class="c1">#</span>
<span class="c1">#    Original FORTRAN77 version by Robert Piessens, Maria Branders.</span>
<span class="c1">#    PYTHON version by John Burkardt.</span>
<span class="c1">#</span>
<span class="c1">#  Reference:</span>
<span class="c1">#</span>
<span class="c1">#    Robert Piessens, Maria Branders,</span>
<span class="c1">#    A Note on the Optimal Addition of Abscissas to Quadrature Formulas</span>
<span class="c1">#    of Gauss and Lobatto,</span>
<span class="c1">#    Mathematics of Computation,</span>
<span class="c1">#    Volume 28, Number 125, January 1974, pages 135-139.</span>
<span class="c1">#</span>
<span class="c1">#  Parameters:</span>
<span class="c1">#</span>
<span class="c1">#    Input, integer N, the order of the Gauss rule.</span>
<span class="c1">#</span>
<span class="c1">#    Input, real TOL, the requested absolute accuracy of the</span>
<span class="c1">#    abscissas.</span>
<span class="c1">#</span>
<span class="c1">#    Output, real X(N+1), the abscissas.</span>
<span class="c1">#</span>
<span class="c1">#    Output, real W1(N+1), the weights for the Gauss-Kronrod rule.</span>
<span class="c1">#</span>
<span class="c1">#    Output, real W2(N+1), the weights for the Gauss rule.</span>
<span class="c1">#</span>
  <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">pi</span>
  <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span>
  <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>
  <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span>
  <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

  <span class="n">tau_dim</span> <span class="o">=</span> <span class="p">(</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
  <span class="n">tau_dim</span> <span class="o">=</span> <span class="nb">int</span> <span class="p">(</span> <span class="n">floor</span> <span class="p">(</span> <span class="n">tau_dim</span> <span class="p">)</span> <span class="p">)</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">zeros</span> <span class="p">(</span> <span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span>
  <span class="n">tau</span> <span class="o">=</span> <span class="n">zeros</span> <span class="p">(</span> <span class="n">tau_dim</span> <span class="p">)</span>
  <span class="n">w1</span> <span class="o">=</span> <span class="n">zeros</span> <span class="p">(</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="n">w2</span> <span class="o">=</span> <span class="n">zeros</span> <span class="p">(</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span> <span class="p">(</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="n">m</span> <span class="o">=</span> <span class="nb">int</span> <span class="p">(</span> <span class="n">floor</span> <span class="p">(</span> <span class="p">(</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
  <span class="n">even</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">==</span> <span class="n">n</span> <span class="p">)</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mf">2.0</span>
  <span class="n">an</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
    <span class="n">an</span> <span class="o">=</span> <span class="n">an</span> <span class="o">+</span> <span class="mf">1.0</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">an</span> <span class="o">/</span> <span class="p">(</span> <span class="n">an</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="p">)</span>
  <span class="n">tau</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">an</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">an</span> <span class="o">+</span> <span class="n">an</span> <span class="o">+</span> <span class="mf">3.0</span> <span class="p">)</span>
  <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.0</span>
  <span class="n">ak</span> <span class="o">=</span> <span class="n">an</span>
  <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="p">):</span>
    <span class="n">ak</span> <span class="o">=</span> <span class="n">ak</span> <span class="o">+</span> <span class="mf">2.0</span>
    <span class="n">tau</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span> <span class="n">ak</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="o">*</span> <span class="n">ak</span> \
      <span class="o">-</span> <span class="n">an</span> <span class="o">*</span> <span class="p">(</span> <span class="n">an</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">ak</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="p">)</span> <span class="o">*</span> <span class="n">tau</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> \
      <span class="o">/</span> <span class="p">(</span> <span class="n">ak</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span> <span class="n">ak</span> <span class="o">+</span> <span class="mf">3.0</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">ak</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="p">)</span> \
      <span class="o">-</span> <span class="n">an</span> <span class="o">*</span> <span class="p">(</span> <span class="n">an</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
      <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tau</span><span class="p">[</span><span class="n">ll</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="n">ll</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
  <span class="n">bb</span> <span class="o">=</span> <span class="n">sin</span> <span class="p">(</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="p">(</span> <span class="n">an</span> <span class="o">+</span> <span class="n">an</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="p">)</span>
  <span class="n">x1</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">bb</span> <span class="o">*</span> <span class="n">bb</span> <span class="p">)</span>
  <span class="n">s</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">bb</span> <span class="o">*</span> <span class="n">x1</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="n">s</span> <span class="p">)</span>
  <span class="n">coef</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">an</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">an</span> <span class="o">*</span> <span class="n">an</span> <span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">x1</span>
  <span class="n">coef2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
    <span class="n">coef2</span> <span class="o">=</span> <span class="n">coef2</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span> <span class="n">n</span> <span class="o">+</span> <span class="n">i</span> <span class="p">)</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">):</span>
    <span class="p">[</span> <span class="n">xx</span><span class="p">,</span> <span class="n">w1</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="n">abwe1</span> <span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">even</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">xx</span> <span class="p">)</span>
    <span class="n">w2</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x1</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">bb</span> <span class="o">*</span> <span class="n">s</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">bb</span> <span class="o">*</span> <span class="n">c</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">k</span> <span class="o">==</span> <span class="n">n</span> <span class="p">):</span>
      <span class="n">xx</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">xx</span> <span class="o">=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">x1</span>
    <span class="p">[</span> <span class="n">xx</span><span class="p">,</span> <span class="n">w1</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">w2</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="n">abwe2</span> <span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">even</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">xx</span> <span class="p">)</span>
    <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x1</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">bb</span> <span class="o">*</span> <span class="n">s</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">bb</span> <span class="o">*</span> <span class="n">c</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">x1</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">even</span> <span class="p">):</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="p">[</span> <span class="n">xx</span><span class="p">,</span> <span class="n">w1</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="n">abwe1</span> <span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">even</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">xx</span> <span class="p">)</span>
    <span class="n">w2</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span>
  <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span></div>

<div class="viewcode-block" id="GaussKronrod"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.GaussKronrod">[docs]</a><span class="k">def</span> <span class="nf">GaussKronrod</span><span class="p">(</span><span class="n">NN</span><span class="p">):</span>
    <span class="c1"># Rescale to [-0.5,0.5] and expand to get all points.</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">kronrod</span><span class="p">(</span><span class="n">NN</span><span class="p">,</span><span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">indx</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">w1</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">w2</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">1e-7</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="o">-</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])),</span> <span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">w1</span><span class="p">,</span><span class="n">w1</span><span class="p">[</span><span class="mi">1</span><span class="p">:])),</span> <span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">w2</span><span class="p">,</span><span class="n">w2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="o">-</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)),</span> <span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">w1</span><span class="p">,</span><span class="n">w1</span><span class="p">)),</span> <span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">w2</span><span class="p">,</span><span class="n">w2</span><span class="p">))</span>
    <span class="n">indx</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">w1</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">w2</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">w1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">w2</span><span class="o">/</span><span class="mi">2</span></div>

<span class="c1">##############################################################</span>
<span class="c1">#</span>
<span class="c1"># New matrixclass for spectral matrix</span>
<span class="c1"># Idea : Split A into two smaller matrices</span>
<span class="c1"># A(mxm) = U(mxn)*U^t where U=sqrt(lambda_i) [v_1 v_2 ...]</span>
<span class="c1"># labda, v are eigvalues, vectors</span>
<span class="c1">#</span>
<span class="c1"># The magic takes place in Matrix multiply function</span>
<span class="c1">#</span>
<span class="c1"># TODO: adding two gives full matrix! Should be easy to fix.</span>

<div class="viewcode-block" id="SpectralMatrix"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.SpectralMatrix">[docs]</a><span class="k">class</span> <span class="nc">SpectralMatrix</span><span class="p">:</span>
    <span class="c1"># self.L/R : Left / right matrices</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">A</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># Initialize ... only Hermitean matrices</span>
            <span class="n">ev</span><span class="p">,</span><span class="n">evec</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="c1"># Drop eigenvalues</span>
            <span class="n">indx</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span><span class="o">&gt;</span><span class="n">cutoff</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ev</span><span class="p">,</span> <span class="n">evec</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">evec</span><span class="p">[:,</span><span class="n">indx</span><span class="p">]</span>
            <span class="k">print</span> <span class="s2">&quot;SpectralMatrix: Fraction of eigenvalues above cutoff (</span><span class="si">%.1e</span><span class="s2">) is </span><span class="si">%i</span><span class="s2">/</span><span class="si">%i</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cutoff</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">indx</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">evec</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">ev</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">dagger</span><span class="p">(</span><span class="n">evec</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">N</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">))</span>
                
<div class="viewcode-block" id="SpectralMatrix.full"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.SpectralMatrix.full">[docs]</a>    <span class="k">def</span> <span class="nf">full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">subtract</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c1"># Could be improved for addition of two spectral matrices</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">SpectralMatrix</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="o">+</span><span class="n">b</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">NN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Na</span><span class="p">,</span> <span class="n">Nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">Na</span><span class="o">+</span><span class="n">Nb</span><span class="o">&gt;</span><span class="mf">0.3</span><span class="o">*</span><span class="n">NN</span><span class="p">:</span>
                <span class="c1"># Too many eigenvalues</span>
                <span class="k">print</span> <span class="s2">&quot;Too many eigenvalues&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">subtract</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="o">+</span><span class="n">b</span><span class="o">.</span><span class="n">full</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">full</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span><span class="o">=</span><span class="n">SpectralMatrix</span><span class="p">()</span>
                <span class="n">res</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NN</span><span class="p">,</span><span class="n">Na</span><span class="o">+</span><span class="n">Nb</span><span class="p">),</span><span class="n">N</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span> <span class="c1"># Always assume complex !?</span>
                <span class="n">res</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Na</span><span class="o">+</span><span class="n">Nb</span><span class="p">,</span><span class="n">NN</span><span class="p">),</span><span class="n">N</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span> <span class="c1"># Always assume complex !?</span>
                <span class="n">res</span><span class="o">.</span><span class="n">L</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Na</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Na</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">subtract</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">L</span><span class="p">[:,</span><span class="n">Na</span><span class="p">:</span><span class="n">Na</span><span class="o">+</span><span class="n">Nb</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">Na</span><span class="p">:</span><span class="n">Na</span><span class="o">+</span><span class="n">Nb</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">R</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">L</span><span class="p">[:,</span><span class="n">Na</span><span class="p">:</span><span class="n">Na</span><span class="o">+</span><span class="n">Nb</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">Na</span><span class="p">:</span><span class="n">Na</span><span class="o">+</span><span class="n">Nb</span><span class="p">,:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">R</span>
                <span class="k">return</span> <span class="n">res</span>
            
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">+</span><span class="n">b</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">SpectralMatrix</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">()</span><span class="o">-</span><span class="n">b</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">subtract</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">SpectralMatrix</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">subtract</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">SpectralMatrix</span><span class="p">()</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span>
        <span class="k">return</span> <span class="n">tmp</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">*</span><span class="n">b</span>

    <span class="k">def</span> <span class="nf">__dagger__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">SpectralMatrix</span><span class="p">()</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">dagger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">dagger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmp</span></div>
    
<div class="viewcode-block" id="trace"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.trace">[docs]</a><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">SpectralMatrix</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">mm</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">R</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">L</span><span class="p">))</span> <span class="c1"># Switch sum around to make faster!</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="dagger"><a class="viewcode-back" href="../../api-gen/Inelastica.MiscMath.html#Inelastica.dagger">[docs]</a><span class="k">def</span> <span class="nf">dagger</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># Hermitian conjugation</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">SpectralMatrix</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">__dagger__</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2002-2018, Magnus Paulsson and Thomas Frederiksen.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.3.0-10',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>